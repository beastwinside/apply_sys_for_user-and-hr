<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>供应商信息</title>
<script src="./bull/script/boot.js" type="text/javascript"></script>
<script src="./bull/script/miniui/pagertree.js" type="text/javascript"></script>
<script src="./bull/script/json2.js"></script> 
<SCRIPT LANGUAGE="JavaScript">
var grid = null;
var form = null;
var p_url = "BullInitServletListener?classname=m_baseinfo.trainlist_user.TrainlistCtl&method=";



$(function(){
	mini.parse();
	form = new mini.Form("#submitForm");
	grid = mini.get("datagrid1");

	grid.setUrl(p_url+"search");


	
	//绑定右键菜单
	 $("body").bind("contextmenu", function (e) {
		var menu = mini.get("contextMenu");
		menu.showAtPos(e.pageX, e.pageY);
		return false;
	});
	
	 grid.on("drawcell", function (e) {
			var record = e.record,
	        column = e.column,
	        field = e.field,
	        value = e.value;
		
			//action列，超连接操作按钮
			if (column.name == "STATUS") {
				e.cellStyle = "text-align:center";
				if(record.STATUS=="可报名")
				{	e.cellHtml ='<img src="./bull/images/btn/apply.png" onclick=bt_baoming('+record.ID+') />';}
				
				
			}
			if (column.name == "STATUS") {
				e.cellStyle = "text-align:center";
				if(record.STATUS=="可评测")
				{	e.cellHtml ='<img src="./bull/images/btn/assess.png" onclick=bt_pinggu('+record.ID+') />';}
			}
			if (column.name == "GSSYB") {
				e.cellStyle = "text-align:center";
			
			}
			if (column.name == "BM") {
				e.cellStyle = "text-align:center";
				e.cellHtml = '<img src="./bull/images/btn/dz.png" onclick="bt_fp(\'' + record.ID + '\',\'bm\')"/>';
			}
			else e.cellStyle = "text-align:center";
		});
	bt_search();	
});


function bt_search(){
	$("#method").val("search");
	form = new mini.Form("#submitForm");
	var data = form.getData();
	//alert(JSON.stringify(encodeURI(encodeURI(data))));
	grid.load(data);

}


function bt_baoming(e){

 mini.open({
			url: p_url+"showPage&pagetype=apply&id="+e,showMaxButton:true,
			title: "修改报名项目信息", width: "70%", height: "55%",
			onload: function () {
				var iframe = this.getIFrameEl();
				var data = { action: "edit"};
			},
			ondestroy: function (action) {
				grid.load(form.getData());
			}
		});}
		

function bt_pinggu(e){

 mini.open({
			url: p_url+"showPage&pagetype=assess&id="+e,showMaxButton:true,
			title: "修改项目评价信息", width: "70%", height: "55%",
			onload: function () {
				var iframe = this.getIFrameEl();
				var data = { action: "edit"};
			},
			ondestroy: function (action) {
				grid.load(form.getData());
			}
		});}
		
function bt_add(){
 mini.open({
			url: p_url+"showPage&pagetype=add",showMaxButton:true,
			title: "新增报名项目信息", width: "70%", height: "55%",
			onload: function () {
				var iframe = this.getIFrameEl();
				var data = { action: "new"};
			},
			ondestroy: function (action) {            
				grid.load(form.getData(true));
			}
		});
}
function bt_assess(){
	 mini.open({
				url: p_url+"showPage&pagetype=add",showMaxButton:true,
				title: "新增报名项目信息", width: "70%", height: "55%",
				onload: function () {
					var iframe = this.getIFrameEl();
					var data = { action: "new"};
				},
				ondestroy: function (action) {            
					grid.load(form.getData(true));
				}
			});
	}
function bt_del(){
	var rows = grid.getSelecteds();
	if (rows.length > 0) {
		mini.confirm("确定作废记录？", "确定？",
            function (action) {
                if (action == "ok") {
                   var ids = [];
					for (var i = 0, l = rows.length; i < l; i++) {
						var r = rows[i];
						ids.push(r.ID);
					}
					var id = ids.join(',');
					grid.loading("操作中，请稍后......");
					$.ajax({
						url:p_url+"delete&ids="+id,
						success: function (text) {
							grid.reload();
						},
						error: function () {
						}
					});
                } 
            }
        );
	} else {
		mini.alert('请选中一条记录!','提示');
	}
}
function keyup_sales(){
	var obj = mini.get("sales");
	var url = "BullInitServletListener?classname=m_hr.employee.EmployeeCtl&method=search&jobname="+obj.getText();
	url = encodeURI(encodeURI(url));
	obj.load(url);
}
</script>
</head>
<body style="padding:2px">
<form name="submitForm" id="submitForm" method="post" action="BullInitServletListener">
<!---右键菜单--->
<ul id="contextMenu" class="mini-contextmenu" >
		<li iconCls="icon-search" onclick="bt_search">查询</li>
		<li iconCls="icon-add" onclick="bt_add">新增</li>

	
</ul>
<div id="panel1" class="mini-panel" title="查询条件" style="width:99%;margin-right: auto; margin-left: auto;margin-bottom:5px" showCollapseButton="true" collapseOnTitleClick="true">
		<div style="padding:10px 60px 0px 30px;margin-right: auto; margin-left: auto;">
	    	<table>
	    		<tr>
	    			<td>项目名称：</td>
	    			<td><input class="mini-textbox" id="proname" name="proname" style="width:120px"/></td>
					<td>项目地址：</td>
					<td><input class="mini-textbox" id="proaddress" name="proaddress"style="width:120px" value=""/></td>
					
				
					<td>
					&nbsp;&nbsp;<a class="mini-button" iconCls="icon-search" onclick="bt_search()" id="but_search">查询</a>
					&nbsp;&nbsp;<a class="mini-button" iconCls="icon-add" onclick="bt_add()">报名（新增）</a>
			
						&nbsp;&nbsp;<a class="mini-button" iconCls="icon-add" onclick="bt_assess()">评价</a>
							</td>
					</tr>
	    	</table>
	</div>
</div>

<div id="datagrid1" class="mini-datagrid" style="width:99%;height:450px;margin-right: auto; margin-left: auto;" allowResize="true" sizeList="[15,30,50,100]" pageSize="15"  allowAlternating="true"idField="id" multiSelect="true"  showSummaryRow="true">
	<div property="columns">
		 <div field="ID" name="ID"  type="checkcolumn" headerAlign="center" width="0"    ></div>
		 <div field="PRO_NAME" headerAlign="center" width="50" name=PRO_NAME"" >参训项目名称</div>
		 <div field="BEGIN_TIME" headerAlign="center"  width="50" name="BEGIN_TIME"  dateformat="yyyy-MM-dd">项目开始时间</div>
		 <div field="END_TIME" headerAlign="center"  width="50" name="END_TIME"  dateformat="yyyy-MM-dd">项目结束时间</div>
		 <div field="PEOPLE_NUM" headerAlign="center"  width="50" name="PEOPLE_NUM">参训项目最大人数</div>
		 <div field="PRO_DETAIL" headerAlign="center"  width="70" name="PRO_DETAIL">项目具体内容和注意事项</div>
		 <div field="PRO_ADDRESS" headerAlign="center"  width="50" name="PRO_ADDRESSS">参加培训的地址</div>
		 <div field="STATUS" headerAlign="center"  width="26" name="STATUS">培训项目状态</div>
	
		 
		 
		
		
	</div>
</div>
</form>

</div>
</body>
</html>